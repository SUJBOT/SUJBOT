# Docker Compose override for DEVELOPMENT environment
#
# =============================================================================
# USAGE (both prod and dev on same server):
# =============================================================================
#
#   PRODUCTION:
#     docker compose -f docker-compose.yml -p sujbot up -d
#
#   DEVELOPMENT:
#     docker compose --env-file .env.dev -p sujbot_dev up -d
#
# =============================================================================
#
# This creates completely isolated environments:
#   - Different container names (sujbot_* vs sujbot_dev_*)
#   - Different networks
#   - Different ports (prod: 80/443, dev: 8280/8443)
#   - Shared volumes by default (uncomment volumes section for full isolation)
#
# =============================================================================

services:
  postgres:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_postgres
    ports:
      - "${POSTGRES_PORT:-5432}:5432"     # PostgreSQL

  redis:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_redis
    ports:
      - "${REDIS_PORT:-6379}:6379"        # Redis

  backend:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_backend
    ports:
      - "${BACKEND_PORT:-8000}:8000"      # FastAPI
    environment:
      LANGSMITH_PROJECT_NAME: ${LANGSMITH_PROJECT_NAME:-sujbot-multi-agent}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}

  frontend:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_frontend
    ports:
      - "${FRONTEND_PORT:-5173}:5173"     # Vite dev server

  nginx:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_nginx
    # Ports configured via NGINX_HTTP_PORT and NGINX_HTTPS_PORT in base file

  pgadmin:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_pgadmin
    ports:
      - "${PGADMIN_PORT:-5050}:80"        # pgAdmin UI

  certbot:
    container_name: ${COMPOSE_PROJECT_NAME:-sujbot}_certbot

# Network name based on project
networks:
  sujbot_net:
    name: ${COMPOSE_PROJECT_NAME:-sujbot}_net
    ipam:
      config:
        - subnet: 172.25.0.0/16

# Uncomment for isolated dev volumes (prevents data sharing with prod)
# volumes:
#   postgres_data:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_postgres_data
#   redis_data:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_redis_data
#   model_cache:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_model_cache
#   pgadmin_data:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_pgadmin_data
#   certbot_certs:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_certbot_certs
#   certbot_www:
#     name: ${COMPOSE_PROJECT_NAME:-sujbot}_certbot_www
